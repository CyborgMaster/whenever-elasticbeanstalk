#!/usr/bin/ruby
require 'rubygems'
gem 'aws-sdk'

require 'aws-sdk'

instance_id = `/opt/aws/bin/ec2-metadata -i | awk '{print $2}'`.strip
environment = ENV["RAILS_ENV"]

AWS_CREDENTIALS = YAML.load_file("config/whenever-elasticbeanstalk.yml")[environment]
AWS.config(AWS_CREDENTIALS)
ec2 = AWS::EC2.new

if ec2.instances[instance_id].tags["leader"] == "true"
	`bundle exec whenever --roles leader --set 'environment=#{environment}&path=/var/app/current' --update-crontab`
else
	`bundle exec whenever --set 'environment=#{environment}&path=/var/app/current' --update-crontab`
end